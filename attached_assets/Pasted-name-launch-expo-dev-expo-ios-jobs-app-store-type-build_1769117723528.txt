name: launch.expo.dev/expo/ios
jobs:
  app-store:
    type: build
    params:
      platform: ios
      profile: production
    env:
      LAUNCH_HOST: launch.expo.dev
      LAUNCH_ID: 748833df-0d12-4fc8-90b4-b1f3354dee2f
      LAUNCH_RUN_ID: 263b20e4-e3be-4e75-9b88-b6f670a58186
      EAS_NO_VCS: '1'
      COREPACK_DEFAULT_TO_LATEST: '0'
      COREPACK_ENABLE_AUTO_PIN: '0'
      COREPACK_ENABLE_STRICT: '0'
      COREPACK_INTEGRITY_KEYS: '0'
    steps:
      - name: ğŸ—ï¸  Prepare project
        uses: eas/checkout
      - name: ğŸ—ï¸  Prepare Launch
        run: bun add --global eas-cli @expo/launching@0.0.0-20260122-000a5c52 pod-install
      - name: ğŸ“¦  Install dependencies
        run: launching node:install
      - name: âš™ï¸  Configure project
        run: launching expo:manifest "{\"name\":\"matchday\",\"slug\":\"matchday\",\"owner\":\"442apps\",\"extra\":{\"eas\":{\"projectId\":\"3090bb75-d133-4dc4-bedd-b15bca350b12\"}},\"ios\":{\"appleTeamId\":\"98X6K5ZSV4\",\"bundleIdentifier\":\"com.442apps.matchdayhub\",\"infoPlist\":{\"ITSAppUsesNonExemptEncryption\":false}}}"
      - name: âš™ï¸  Prebuild Expo project
        run: launching expo:prebuild --no-install --platform "ios" --apple-team-id "98X6K5ZSV4"
      - name: âš™ï¸  Configure Xcode project
        run: launching xcode:configure
      - name: âš™ï¸  Synchronize Xcode native targets
        run: launching xcode:targets
      - name: âš™ï¸  Synchronize Xcode entitlements
        run: launching xcode:entitlements --framework "expo"
      - name: âš™ï¸  Resolve build config
        uses: eas/resolve_build_config
      - name: âš™ï¸  Configure build for updates
        uses: eas/configure_eas_update
        with:
          throw_if_not_configured: false
      - name: âš™ï¸  Export Expo app
        run: launching expo:export-eager --platform "ios"
      - name: âš™ï¸  Configure iOS credentials
        uses: eas/configure_ios_credentials
      - name: âš™ï¸  Configure iOS version
        uses: eas/configure_ios_version
      - name: âš™ï¸  Configure iOS build template
        uses: eas/generate_gymfile_from_template
        with:
          credentials: ${ eas.job.secrets.buildCredentials }
      - name: ğŸ“¦  Install iOS dependencies
        run: pod-install
      - name: âš™ï¸  Create iOS build
        uses: eas/run_fastlane
      - name: ğŸš€  Store iOS build
        uses: eas/find_and_upload_build_artifacts
      - name: ğŸš€  Submit to App Store
        run: launching eas:ios-submit --app-bundle-id "${ eas.metadata.appIdentifier }" --app-id "6758116925" --app-name "${ eas.metadata.appName }" --build-id "${ eas.env.EAS_BUILD_ID }" --build-number "${ eas.metadata.appBuildVersion }" --submit-profile "${ eas.env.EAS_BUILD_PROFILE }"
      - name: ğŸš€  Store App Store submission
        uses: eas/create_submission_entity
        with:
          build_id: ${ eas.env.EAS_BUILD_ID }
          apple_id_username: aucamp.ben@gmail.com
          asc_app_identifier: '6758116925'